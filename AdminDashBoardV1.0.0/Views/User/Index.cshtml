@* @model IEnumerable<UserViewModel>
@{
	ViewData["Title"] = "Index";
}
<h1>All Users</h1>
<hr />

@if (Model.Count() > 0)
{
	<table class="table table-striped table-hover">
		<thead>
			<tr>
				<th>@Html.DisplayNameFor(u => u.UserName)</th>
				<th>@Html.DisplayNameFor(u => u.DisplayName)</th>
				<th>@Html.DisplayNameFor(u => u.Email)</th>
				<th>@Html.DisplayNameFor(u => u.PhoneNumber)</th>
				<th>Roles</th>
				<th>Actions</th>
			</tr>
		</thead>
		<tbody>
			@foreach (var user in Model)
			{
				<tr>
					<td>@user.UserName</td>
					<td>@user.DisplayName</td>
					<td>@user.Email</td>
					<td>@user.PhoneNumber</td>
					<td>@string.Join(",", user.Roles.ToList())</td>

					<td>
						<a class="btn btn-outline-warning" asp-action="Edit" asp-route-id="@user.Id">Edit </a>
						<form asp-action="Delete" asp-route-id="@user.Id" method="post" style="display:inline;">
							<button type="submit" class="btn btn-outline-danger">Delete</button>
						</form>

					</td>

				</tr>
			}
		</tbody>
	</table>
}
else
{
	<div class="mt-3 p-3 alert-warning">
		<h2>There is no users</h2>
	</div>
}
@section Scripts {
	<partial name="_ValidationScriptsPartial" />
} *@


@model IEnumerable<UserViewModel>
@{
	ViewData["Title"] = "Users Management";
}

<div class="users-page">
	<!-- Page Header -->
	<div class="page-header mb-4">
		<div>
			<h1 class="mb-2">
				<i class="fas fa-users me-2"></i>Users Management
			</h1>
			<p class="text-muted">Manage system users and their roles</p>
		</div>
		<div class="header-stats">
			<div class="stat-badge">
				<i class="fas fa-user-friends"></i>
				<span>@Model.Count() Users</span>
			</div>
		</div>
	</div>

	<!-- Users Table Card -->
	@if (Model.Count() > 0)
	{
		<div class="card users-table-card">
			<div class="card-header">
				<h5 class="mb-0">
					<i class="fas fa-list me-2"></i>All Users
				</h5>
				<div class="search-box">
					<i class="fas fa-search"></i>
					<input type="text" id="searchInput" class="form-control" placeholder="Search users...">
				</div>
			</div>
			<div class="card-body p-0">
				<div class="table-responsive">
					<table class="table table-hover align-middle mb-0" id="usersTable">
						<thead>
							<tr>
								<th>User</th>
								<th>Email</th>
								<th>Phone Number</th>
								<th>Roles</th>
								<th style="width: 150px;">Actions</th>
							</tr>
						</thead>
						<tbody>
							@foreach (var user in Model)
							{
								<tr>
									<td>
										<div class="user-info">
											<div class="user-avatar">
												<i class="fas fa-user"></i>
											</div>
											<div class="user-details">
												<span class="user-name">@user.DisplayName</span>
												<span class="user-username">@@@user.UserName</span>
											</div>
										</div>
									</td>
									<td>
										<div class="email-cell">
											<i class="fas fa-envelope me-2 text-muted"></i>
											<span>@user.Email</span>
										</div>
									</td>
									<td>
										<div class="phone-cell">
											<i class="fas fa-phone me-2 text-muted"></i>
											<span>@user.PhoneNumber</span>
										</div>
									</td>
									<td>
										<div class="roles-cell">
											@if (user.Roles != null && user.Roles.Any())
											{
												@foreach (var role in user.Roles)
												{
													<span class="role-badge">@role</span>
												}
											}
											else
											{
												<span class="text-muted small">No roles</span>
											}
										</div>
									</td>
									<td>
										<div class="action-buttons">
											<a class="btn-action btn-edit" asp-action="Edit" asp-route-id="@user.Id" title="Edit Roles">
												<i class="fas fa-user-edit"></i>
											</a>
											<button class="btn-action btn-delete"
													onclick="confirmDelete('@user.Id', '@user.UserName')"
													title="Delete">
												<i class="fas fa-trash-alt"></i>
											</button>
										</div>
									</td>
								</tr>
							}
						</tbody>
					</table>
				</div>
			</div>
		</div>
	}
	else
	{
		<div class="empty-state">
			<div class="empty-icon">
				<i class="fas fa-users"></i>
			</div>
			<h3>No Users Found</h3>
			<p>There are no users in the system yet</p>
		</div>
	}
</div>

<!-- Delete Confirmation Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
	<div class="modal-dialog modal-dialog-centered">
		<div class="modal-content">
			<div class="modal-header border-0">
				<h5 class="modal-title">
					<i class="fas fa-exclamation-triangle text-danger me-2"></i>
					Confirm Delete User
				</h5>
				<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
			</div>
			<div class="modal-body">
				<p class="mb-0">Are you sure you want to delete user <strong id="userNameToDelete"></strong>?</p>
				<p class="text-muted small mt-2">This action cannot be undone and will remove all user data.</p>
			</div>
			<div class="modal-footer border-0">
				<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
				<form id="deleteForm" method="post" style="display:inline;">
					<button type="submit" class="btn btn-danger">
						<i class="fas fa-trash-alt me-2"></i>Delete User
					</button>
				</form>
			</div>
		</div>
	</div>
</div>

@section Scripts {
	<partial name="_ValidationScriptsPartial" />
	<script>
		// Search functionality
		document.getElementById('searchInput')?.addEventListener('keyup', function() {
			const searchText = this.value.toLowerCase();
			const rows = document.querySelectorAll('#usersTable tbody tr');

			rows.forEach(row => {
				const text = row.textContent.toLowerCase();
				row.style.display = text.includes(searchText) ? '' : 'none';
			});
		});

		// Delete confirmation
		let deleteModal;
		document.addEventListener('DOMContentLoaded', function() {
			deleteModal = new bootstrap.Modal(document.getElementById('deleteModal'));
		});

		function confirmDelete(id, username) {
			document.getElementById('userNameToDelete').textContent = username;
			const form = document.getElementById('deleteForm');
			form.action = '/User/Delete/' + id;
			deleteModal.show();
		}
	</script>
}
